@using Microsoft.AspNetCore.Components.Authorization
@using HotelBooking.Web.Services
@inherits LayoutComponentBase
@inject IAuthService AuthService
@inject NavigationManager NavManager

<div class="layout-wrapper">
    <header class="navbar navbar-expand-lg navbar-dark skull-navbar">
        <div class="container-fluid px-4">

            <a class="navbar-brand d-flex align-items-center gap-3" href="/">
                <div class="skull-icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#ff9900" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 40px;">
                        <circle cx="9" cy="12" r="1" />
                        <circle cx="15" cy="12" r="1" />
                        <path d="M8 20v2h8v-2" />
                        <path d="m12.5 17-.5-1-.5 1h1z" />
                        <path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20" />
                    </svg>
                </div>
                <div class="d-flex flex-column">
                    <span class="brand-title">SKULL KING</span>
                    <span class="brand-subtitle">Hôtel & Aventures</span>
                </div>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="navbarContent">

                <ul class="navbar-nav align-items-center gap-4 me-5">
                    <li class="nav-item">
                        <NavLink class="nav-link custom-link" href="rooms">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                <circle cx="12" cy="5" r="3" />
                                <line x1="12" y1="22" x2="12" y2="8" />
                                <path d="M5 12H2a10 10 0 0 0 20 0h-3" />
                            </svg>
                            <span>Chambres</span>
                        </NavLink>
                    </li>
                    <li class="nav-item">
                        <NavLink class="nav-link custom-link" href="experiences">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                <polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21" />
                                <line x1="9" x2="9" y1="3" y2="18" />
                                <line x1="15" x2="15" y1="6" y2="21" />
                            </svg>
                            <span>Expériences</span>
                        </NavLink>
                    </li>
                    <li class="nav-item">
                        <NavLink class="nav-link custom-link" href="#contact">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                            </svg>
                            <span>Contact</span>
                        </NavLink>
                    </li>

                    <AuthorizeView Roles="Admin">
                        <li class="nav-item">
                            <NavLink class="nav-link custom-link" href="admin/setup">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#ff9900" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                </svg>
                                <span style="color: #ff9900;">Admin</span>
                            </NavLink>
                        </li>
                    </AuthorizeView>
                </ul>

                <div class="d-flex align-items-center">
                    <AuthorizeView>
                        <Authorized>
                            <div class="d-flex align-items-center gap-3">
                                <a href="profile" class="nav-link custom-link text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                        <circle cx="12" cy="7" r="4" />
                                    </svg>
                                    Mon profil
                                </a>
                                <button @onclick="LogoutUser" class="btn-logout d-flex align-items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                        <polyline points="16 17 21 12 16 7" />
                                        <line x1="21" x2="9" y1="12" y2="12" />
                                    </svg>
                                    Déconnexion
                                </button>
                            </div>
                        </Authorized>
                        <NotAuthorized>
                            <a href="login" class="btn btn-skull-primary d-flex align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="min-width: 18px; margin-right: 8px;">
                                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                                <span>Connexion</span>
                            </a>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        @Body
    </main>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@code {
    private async Task LogoutUser()
    {
        await AuthService.Logout();
        NavManager.NavigateTo("/", true);
    }
}

<style>
    /* Variables de couleurs */
    :root {
        --skull-dark: #0d1117;
        --skull-amber: #ff9900;
        --skull-text-grey: #94a3b8;
    }

    /* Structure de base */
    .layout-wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background-color: var(--skull-dark);
    }

    /* Navbar Customisation */
    .skull-navbar {
        background-color: rgba(13, 17, 23, 0.95);
        padding: 0.8rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
    }

    /* Logo & Marque */
    .skull-icon-container {
        color: var(--skull-amber);
        display: flex;
        align-items: center;
    }

    .brand-title {
        color: var(--skull-amber);
        font-weight: bold;
        letter-spacing: 1px;
        line-height: 1.2;
        font-size: 1.2rem;
        text-transform: uppercase;
    }

    .brand-subtitle {
        color: var(--skull-text-grey);
        font-size: 0.85rem;
        line-height: 1;
    }

    /* Liens de Navigation */
    .custom-link {
        color: #e2e8f0 !important;
        font-weight: 500;
        font-size: 1rem;
        transition: color 0.3s;
        display: flex !important; /* Force le flexbox pour aligner icone/texte */
        align-items: center;
    }

        .custom-link:hover {
            color: var(--skull-amber) !important;
        }

            /* Changement de couleur de l'icone SVG au survol du lien parent */
            .custom-link:hover svg {
                stroke: var(--skull-amber) !important;
                transition: stroke 0.3s;
            }

    /* Bouton Connexion (Style Jaune) */
    .btn-skull-primary {
        background-color: var(--skull-amber);
        color: #000;
        font-weight: 600;
        border-radius: 6px;
        padding: 0.5rem 1.2rem;
        border: none;
        transition: all 0.2s;
        text-decoration: none;
        display: flex;
        align-items: center;
    }

        .btn-skull-primary:hover {
            background-color: #e68a00;
            color: #000;
            transform: translateY(-1px);
        }

    /* Bouton Déconnexion */
    .btn-logout {
        background: none;
        border: 1px solid rgba(255,255,255,0.3);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
        transition: all 0.3s;
    }

        .btn-logout:hover {
            border-color: #dc3545;
            color: #dc3545;
            background-color: rgba(220, 53, 69, 0.1);
        }

            .btn-logout:hover svg {
                stroke: #dc3545 !important;
            }

    .main-content {
        flex: 1;
    }

    .pointer {
        cursor: pointer;
    }
</style>