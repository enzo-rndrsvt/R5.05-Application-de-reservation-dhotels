@page "/register"
@using HotelBooking.Web.Models.Auth
@using HotelBooking.Web.Services
@inject IAuthService AuthService
@inject NavigationManager NavManager

<div class="login-page-wrapper d-flex align-items-center justify-content-center min-vh-100 py-5">
    <div class="background-overlay"></div>

    <div class="container position-relative z-10">
        
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-5">
                
                <div class="text-center mb-4">
                    <i class="oi oi-skull display-4 text-amber-500 mb-2"></i>
                    <h4 class="text-amber-500 fw-bold tracking-widest">SKULL KING</h4>
                    <small class="text-slate-400">Rejoignez l'équipage</small>
                </div>

                <div class="card card-login border-0 p-4 shadow-lg">
                    <div class="card-body">
                        
                        <h5 class="text-amber-500 text-center mb-1">Bienvenue matelot !</h5>
                        <p class="text-slate-400 text-center small mb-4">Connectez-vous ou créez un compte pour naviguer</p>

                        <div class="d-flex bg-slate-900 rounded-pill p-1 mb-4">
                            <a href="login" class="btn btn-sm text-slate-400 rounded-pill w-50 hover-text-white text-decoration-none text-center pt-1">Connexion</a>
                            <button class="btn btn-sm btn-amber rounded-pill w-50 fw-bold">Inscription</button>
                        </div>

                        @if (!string.IsNullOrEmpty(errorMessage))
                        {
                            <div class="alert alert-danger bg-danger-subtle text-danger border-0 py-2 small mb-3">
                                <i class="oi oi-warning me-1"></i> @errorMessage
                            </div>
                        }
                        @if (registrationSuccess)
                        {
                            <div class="alert alert-success bg-success-subtle text-success border-0 py-2 small mb-3 text-center">
                                <i class="oi oi-circle-check me-1"></i> Inscription réussie ! Redirection...
                            </div>
                        }
                        else
                        {
                            <EditForm Model="@registerModel" OnValidSubmit="HandleRegistration" FormName="RegisterForm">
                                <DataAnnotationsValidator />

                                <div class="mb-3">
                                    <label class="form-label text-slate-300 small fw-bold">Nom complet</label>
                                    <div class="input-group">
                                        <InputText class="form-control form-control-dark" placeholder="Prénom" @bind-Value="registerModel.FirstName" />
                                        <InputText class="form-control form-control-dark" placeholder="Nom" @bind-Value="registerModel.LastName" />
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <ValidationMessage For="@(() => registerModel.FirstName)" class="text-danger x-small" />
                                        <ValidationMessage For="@(() => registerModel.LastName)" class="text-danger x-small" />
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label text-slate-300 small fw-bold">Email</label>
                                    <InputText type="email" class="form-control form-control-dark" placeholder="captain@skullking.com" @bind-Value="registerModel.Email" />
                                    <ValidationMessage For="@(() => registerModel.Email)" class="text-danger x-small" />
                                </div>

                                <div class="mb-3">
                                    <label class="form-label text-slate-300 small fw-bold">Nom d'utilisateur</label>
                                    <InputText class="form-control form-control-dark" placeholder="Capitaine Jack" @bind-Value="registerModel.Username" />
                                    <ValidationMessage For="@(() => registerModel.Username)" class="text-danger x-small" />
                                </div>

                                <div class="mb-3">
                                    <label class="form-label text-slate-300 small fw-bold">Mot de passe</label>
                                    <InputText type="password" class="form-control form-control-dark" placeholder="••••••••" @bind-Value="registerModel.Password" />
                                    <ValidationMessage For="@(() => registerModel.Password)" class="text-danger x-small" />
                                </div>

                                <div class="mb-4">
                                    <label class="form-label text-slate-300 small fw-bold">Confirmer le mot de passe</label>
                                    <InputText type="password" class="form-control form-control-dark" placeholder="••••••••" @bind-Value="registerModel.ConfirmPassword" />
                                    <ValidationMessage For="@(() => registerModel.ConfirmPassword)" class="text-danger x-small" />
                                </div>

                                <button type="submit" class="btn btn-amber w-100 py-2 fw-bold d-flex align-items-center justify-content-center" disabled="@isLoading">
                                    @if (isLoading)
                                    {
                                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                        <span>Inscription...</span>
                                    }
                                    else
                                    {
                                        <i class="oi oi-key me-2"></i> <span>Rejoindre l'équipage</span>
                                    }
                                </button>
                            </EditForm>
                        }

                    </div>
                </div>

                <div class="text-center mt-4">
                    <p class="text-slate-500 x-small">
                        En vous inscrivant, vous acceptez nos <a href="#" class="text-slate-400">conditions d'utilisation</a>
                    </p>
                </div>

            </div>
        </div>
    </div>
</div>

@code {
    [SupplyParameterFromForm]
    private RegisterRequest registerModel { get; set; } = new();
    
    private string errorMessage = string.Empty;
    private bool isLoading = false;
    private bool registrationSuccess = false;

    private async Task HandleRegistration()
    {
        errorMessage = string.Empty;
        isLoading = true;

        try
        {
            var result = await AuthService.Register(registerModel);

            if (result.Success)
            {
                registrationSuccess = true;
                await Task.Delay(2000); 
                NavManager.NavigateTo("/login");
            }
            else
            {
                errorMessage = result.Message ?? "Une erreur est survenue lors de l'inscription";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Erreur: {ex.Message}";
        }
        finally
        {
            isLoading = false;
        }
    }
}

<style>
    /* VARIABLES */
    :root {
        --color-dark-950: #020617;
        --color-slate-900: #0f172a;
        --color-slate-800: #1e293b;
        --color-slate-400: #94a3b8;
        --color-amber-500: #f59e0b;
        --color-amber-600: #d97706;
    }

    /* BACKGROUND FIXE - IDENTIQUE LOGIN */
    .login-page-wrapper {
        position: relative;
        background-image: url('/uploads/backgroundhomepage.jpg'); 
        background-size: cover;
        background-position: center;
        background-attachment: fixed; 
    }
    
    .background-overlay {
        position: absolute;
        inset: 0;
        background: rgba(2, 6, 23, 0.85); /* Overlay sombre */
        backdrop-filter: blur(4px);
        z-index: 0;
    }
    
    .z-10 { z-index: 10; }

    /* CARD THEME */
    .card-login {
        background-color: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    /* INPUTS */
    .form-control-dark {
        background-color: rgba(30, 41, 59, 0.5);
        border: 1px solid var(--color-slate-800);
        color: #e2e8f0;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
    }
    .form-control-dark:focus {
        background-color: rgba(30, 41, 59, 0.8);
        border-color: var(--color-amber-500);
        color: white;
        box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
    }
    .form-control-dark::placeholder { color: #64748b; }

    /* UTILS */
    .text-amber-500 { color: var(--color-amber-500) !important; }
    .text-slate-300 { color: #cbd5e1 !important; }
    .text-slate-400 { color: var(--color-slate-400) !important; }
    .text-slate-500 { color: #64748b !important; }
    
    .hover-text-amber:hover { color: var(--color-amber-500) !important; }
    .hover-text-white:hover { color: white !important; }

    /* BUTTONS */
    .btn-amber {
        background-color: var(--color-amber-500);
        border: none;
        color: #0f172a;
        transition: all 0.2s;
    }
    .btn-amber:hover {
        background-color: var(--color-amber-600);
        transform: translateY(-1px);
    }
    
    .btn-dark-glass {
        background-color: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(255,255,255,0.1);
        backdrop-filter: blur(4px);
    }
    
    .x-small { font-size: 0.75rem; }
    .tracking-widest { letter-spacing: 0.2em; }
</style>    