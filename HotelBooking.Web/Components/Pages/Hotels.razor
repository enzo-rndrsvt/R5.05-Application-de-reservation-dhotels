@page "/hotels"
@page "/hotel"
@using HotelBooking.Web.Models
@using HotelBooking.Web.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject IHotelService HotelService

<PageTitle>Hôtel SkullKing - L'hôtel des pirates</PageTitle>

<div class="container mt-4">
    <AuthorizeView>
        <Authorized>
            @if (skullKingHotel == null && string.IsNullOrEmpty(errorMessage))
            {
                <div class="text-center p-4">
    <div class="spinner-border text-primary" role="status">
         <span class="visually-hidden">Chargement...</span>
       </div>
           <p class="mt-2">Chargement de l'hôtel SkullKing...</p>
                </div>
     }
            else if (!string.IsNullOrEmpty(errorMessage))
         {
    <div class="alert alert-warning">
       <h4><i class="oi oi-warning"></i> Hôtel SkullKing non trouvé</h4>
    <p>@errorMessage</p>
   <hr>
   <p class="mb-0">L'hôtel doit d'abord être créé via l'administration.</p>
      <div class="mt-3">
       <a href="/admin/setup" class="btn btn-primary">
       <i class="oi oi-wrench"></i> Créer l'hôtel SkullKing
  </a>
          </div>
          </div>
    }
   else if (skullKingHotel != null)
            {
    <!-- En-tête de l'hôtel -->
    <div class="card border-0 shadow-lg mb-4" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
 <div class="card-body text-white">
     <div class="row align-items-center">
     <div class="col-md-8">
 <h1 class="display-4 mb-2">🏴‍☠️ @skullKingHotel.Name</h1>
          <p class="lead mb-3">@skullKingHotel.BriefDescription</p>
       <div class="d-flex align-items-center mb-3">
  @for (int i = 0; i < (int)skullKingHotel.StarRating; i++)
         {
          <span class="fs-4">⭐</span>
  }
      <span class="ms-2 fs-5">@skullKingHotel.StarRating.ToString("0.0") / 5.0</span>
        </div>
             <p class="mb-0">
      <i class="oi oi-person"></i> <strong>Capitaine :</strong> @skullKingHotel.OwnerName
              </p>
            </div>
         <div class="col-md-4 text-center">
 <div class="bg-white bg-opacity-20 rounded p-3">
      <div class="display-6 mb-2">⚓</div>
       <h5>@skullKingHotel.NumberOfRooms</h5>
     <small>Cabines disponibles</small>
           </div>
        </div>
     </div>
      </div>
     </div>

       <!-- Actions principales -->
        <div class="row mb-4">
       <div class="col-md-6">
   <div class="card h-100 border-success">
    <div class="card-body text-center">
        <div class="display-6 text-success mb-3">🛏️</div>
           <h4>Découvrez nos cabines</h4>
   <p class="text-muted">Explorez nos @skullKingHotel.NumberOfRooms chambres thématiques dignes des plus grands pirates</p>
              <a href="/hotels/@skullKingHotel.Id/rooms" class="btn btn-success btn-lg">
      <i class="oi oi-grid-three-up"></i> Voir les cabines
  </a>
    </div>
       </div>
        </div>
    <div class="col-md-6">
     <div class="card h-100 border-primary">
     <div class="card-body text-center">
    <div class="display-6 text-primary mb-3">📋</div>
    <h4>Réserver maintenant</h4>
           <p class="text-muted">Prêt à embarquer pour l'aventure ? Réservez votre cabine dès maintenant !</p>
     <a href="/booking" class="btn btn-primary btn-lg">
      <i class="oi oi-calendar"></i> Faire une réservation
              </a>
        </div>
       </div>
         </div>
       </div>

          <!-- Informations détaillées -->
           <div class="card">
            <div class="card-header">
<h4><i class="oi oi-info"></i> À propos de l'hôtel SkullKing</h4>
</div>
     <div class="card-body">
        <div class="row">
  <div class="col-md-8">
            <h5>Description</h5>
      <p class="lead">Bienvenue à bord du SkullKing, l'hôtel le plus légendaire des sept mers !</p>
             <p>
     Notre établissement @skullKingHotel.StarRating étoiles vous offre une expérience unique 
          au cœur de Paris, où l'aventure pirate rencontre le confort moderne. 
             Sous la direction du capitaine @skullKingHotel.OwnerName, notre équipage 
     vous garantit un séjour inoubliable.
      </p>
        <p>
            Que vous soyez un matelot en quête d'aventure ou un capitaine expérimenté, 
     nos @skullKingHotel.NumberOfRooms cabines soigneusement aménagées sauront 
     répondre à tous vos besoins.
               </p>
        </div>
           <div class="col-md-4">
       <h5>Informations pratiques</h5>
         <dl class="row">
          <dt class="col-6">Nom :</dt>
        <dd class="col-6">@skullKingHotel.Name</dd>
           
      <dt class="col-6">Propriétaire :</dt>
         <dd class="col-6">@skullKingHotel.OwnerName</dd>
           
  <dt class="col-6">Classification :</dt>
            <dd class="col-6">@skullKingHotel.StarRating ⭐</dd>
       
        <dt class="col-6">Chambres :</dt>
 <dd class="col-6">@skullKingHotel.NumberOfRooms cabines</dd>
  </dl>
       </div>
       </div>
   </div>
          </div>
            }
        </Authorized>
        <NotAuthorized>
            <div class="row">
      <div class="col-12">
    <div class="alert alert-warning d-flex align-items-center p-4" role="alert">
             <i class="oi oi-lock-locked me-3 fs-1"></i>
           <div>
       <h4 class="alert-heading">🏴‍☠️ Accès au navire refusé !</h4>
       <p class="mb-3">Pour découvrir l'hôtel SkullKing et ses trésors, il faut d'abord s'identifier, matelot !</p>
       <hr>
           <div class="d-flex gap-2">
       <a href="/login" class="btn btn-primary">
     <i class="oi oi-account-login"></i> Se connecter
                  </a>
    <a href="/register" class="btn btn-outline-primary">
     <i class="oi oi-plus"></i> Créer un compte
   </a>
        </div>
 </div>
              </div>
         </div>
            </div>
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private HotelForUser? skullKingHotel;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await LoadSkullKingHotel();
    }

    private async Task LoadSkullKingHotel()
    {
        try
  {
            // Essayer de récupérer tous les hôtels et chercher SkullKing
            var hotels = await HotelService.GetAllHotelsAsync();
skullKingHotel = hotels.FirstOrDefault(h => h.Name.Contains("SkullKing", StringComparison.OrdinalIgnoreCase));
  
        if (skullKingHotel == null)
     {
    errorMessage = "L'hôtel SkullKing n'a pas encore été créé.";
          }
        }
        catch (Exception ex)
   {
     errorMessage = $"Erreur lors du chargement de l'hôtel SkullKing: {ex.Message}";
        }
    }
}